# Brewster updates package managers
## Homebrew (macOS), npm (Node.js), & pip (Python)

brewsterf() {if read -qr "CHOICE?Press [y]es to run Brewster:  "; then
    sleep 1
    spinner() {
        slt=0.25
        printf "\033c\r${(%):-%F{green}==<${(%):-%f} running Brewster${(%):-%F{green}.  ${(%):-%f}\n"
        sleep $slt
        printf "\033c\r${(%):-%F{green}==/${(%):-%f} running Brewster${(%):-%F{green}.. ${(%):-%f}\n"
        sleep $slt
        printf "\033c\r${(%):-%F{green}==>${(%):-%f} running Brewster${(%):-%F{green}...${(%):-%f}\n"
        sleep $slt
    }
    i=0
    while [ $i -le 3 ]; do
        spinner
        i=$(($i + 1))
    done
    . /Users/syd/Code/misc/Brewster/brewster
    return 0
else
    return 1
fi}

# change directory enhanced
## run cd, list the dir's 10 most recent files

cl() { 
    DIR="$*"
    if [ $# -lt 1 ]; then
        DIR=$PWD
        # if no DIR given, assume $PWD (current working directory)
    fi
    builtin cd "${DIR}"
    # sort by date, descending
    ls -aFGhort    
    # clear screen, insert newline
    printf "\033c\n" 
    lsd|grep  --color=never --invert-match "dr.*" | tail -10
} 

# Globalias expands glob expressions, subcommands, & aliases (including global)

globalias() {
   # https://github.com/ohmyzsh/ohmyzsh/tree/master/plugins/globalias "globalias"
   # Get word to left of cursor
   # (z) => split line into an array
   # (A) => perform an array assignment
   # (I) => match index; start matching from end
   # (e) => force value to be rescanned for all forms of single-word substitution
   # https://zsh.sourceforge.io/Guide/zshguide05.html "Chapter 5: Substitutions"
   local word=${${(Az)LBUFFER}[-1]}
   if [[ $GLOBALIAS_FILTER_VALUES[(Ie)$word] -eq 0 ]]; then
      zle _expand_alias
      zle expand-word
   fi
   zle self-insert
}
zle -N globalias

## space expands all aliases, including global
bindkey -M emacs " " globalias
bindkey -M viins " " globalias

## control-space to make a normal space
bindkey -M emacs "^ " magic-space
bindkey -M viins "^ " magic-space

## normal space during searches
bindkey -M isearch " " magic-space

# yank to system clipboard in Zsh vi-mode

yank-to-clipboard() { 
    zle vi-yank
    echo "$CUTBUFFER"|pbcopy -i
} 
zle -N yank-to-clipboard
